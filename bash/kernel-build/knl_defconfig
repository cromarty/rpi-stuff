#!/bin/bash

if [ $# -ne 1 ]; then
	echo "Usage: $0 <kernel-root>"
	echo "Example: $0 ~/linux-rpi-3.6.y"
	echo
	exit 1
fi

if [ ! -d $1 ]; then
	echo "There is no path to $1"
	exit 1
fi

if [ ! -f "$1/linux/MAINTAINERS" ]; then
	echo "$1/linux does not look like a valid kernel source tree"
	exit 1
fi


export KERNEL_ROOT=$1

# this has to come after KERNEL_ROOT is set above:
[[ -f ~/.knl_exports ]] && . ~/.knl_exports


cd ${KERNEL_SRC}

make O=${KERNEL_BUILD} ARCH=arm CROSS_COMPILE=${CCPREFIX} ${PLATFORM}_defconfig
exit $?

